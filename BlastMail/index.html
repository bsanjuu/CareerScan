<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>BlastMail - Send Emails Easily</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="js/firebase-config.js"></script> <!-- External Firebase Config -->
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #emailForm { display: none; margin-top: 20px; }
        textarea, input { width: 100%; margin-bottom: 10px; padding: 8px; }
        button { padding: 10px 20px; }
    </style>
</head>
<body>

<h1>BlastMail 🚀</h1>

<button onclick="login()">Login with Google</button>

<div id="emailForm">
    <h3>Send Email</h3>
    <label>Recipient Emails (comma-separated):</label><br>
    <textarea id="emails" rows="4"></textarea>

    <label>Subject:</label><br>
    <input id="subject" type="text" />

    <label>Message:</label><br>
    <textarea id="message" rows="6"></textarea>

    <button onclick="sendMail()">Send Email</button>
</div>

<script>
    firebase.initializeApp(window.firebaseConfig);
    const auth = firebase.auth();

    function login() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).then(() => {
            document.getElementById("emailForm").style.display = "block";
        });
    }

    function sendMail() {
        const emails = document.getElementById("emails").value.split(',').map(e => e.trim());
        const subject = document.getElementById("subject").value;
        const message = document.getElementById("message").value;

        fetch("http://localhost:5001/bsanju-blastmail/us-central1/sendEmail", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ emails, subject, message })
        })
            .then(response => response.text())
            .then(data => {
                alert("✅ " + data);
            })
            .catch(err => {
                console.error("❌ Failed:", err);
                alert("Failed to send emails: " + err.message);
            });
    }
</script>

</body>
</html>
